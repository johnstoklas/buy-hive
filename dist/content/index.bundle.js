(()=>{"use strict";const e={"amazon.com":{name:"#productTitle",image:"#landingImage, #imgBlkFront",price:".a-price .a-offscreen, #priceblock_ourprice, #priceblock_dealprice, .a-price-whole, span.a-price"},"amazon.co.uk":{name:"#productTitle",image:"#landingImage, #imgBlkFront",price:".a-price .a-offscreen, #priceblock_ourprice, #priceblock_dealprice, .a-price-whole, span.a-price"},"amazon.de":{name:"#productTitle",image:"#landingImage, #imgBlkFront",price:".a-price .a-offscreen, #priceblock_ourprice, #priceblock_dealprice, .a-price-whole, span.a-price"},"amazon.fr":{name:"#productTitle",image:"#landingImage, #imgBlkFront",price:".a-price .a-offscreen, #priceblock_ourprice, #priceblock_dealprice, .a-price-whole, span.a-price"},"amazon.ca":{name:"#productTitle",image:"#landingImage, #imgBlkFront",price:".a-price .a-offscreen, #priceblock_ourprice, #priceblock_dealprice, .a-price-whole, span.a-price"},"amazon.co.jp":{name:"#productTitle",image:"#landingImage, #imgBlkFront",price:".a-price .a-offscreen, #priceblock_ourprice, #priceblock_dealprice, .a-price-whole, span.a-price"},"ebay.com":{name:'h1.x-item-title__mainTitle, h1.textual-display, h1[data-testid="x-item-title-label"], #x-item-title-label, h1.it-ttl, .x-item-title-label, h1.it-ttl',image:'img[src*="ebayimg.com"], #icImg, img[itemprop="image"], .img.img500, #mainImgHldr img, img.brw-product-card__image',price:'div.x-price-primary, div.x-bin-price__content, span.textual-display, .notranslate[itemprop="price"], #prcIsum, .u-flL.condText, .notranslate, .u-flL.condText .notranslate'},"ebay.co.uk":{name:'h1.x-item-title__mainTitle, h1.textual-display, h1[data-testid="x-item-title-label"], #x-item-title-label, h1.it-ttl, .x-item-title-label, h1.it-ttl',image:'img[src*="ebayimg.com"], #icImg, img[itemprop="image"], .img.img500, #mainImgHldr img, img.brw-product-card__image',price:'div.x-price-primary, div.x-bin-price__content, span.textual-display, .notranslate[itemprop="price"], #prcIsum, .u-flL.condText, .notranslate, .u-flL.condText .notranslate'},"ebay.de":{name:'h1[data-testid="x-item-title-label"], #x-item-title-label, h1.it-ttl, .x-item-title-label, h1.it-ttl',image:'#icImg, img[itemprop="image"], .img.img500, #mainImgHldr img',price:'.notranslate[itemprop="price"], #prcIsum, .u-flL.condText, .notranslate, .u-flL.condText .notranslate'},"ebay.fr":{name:'h1[data-testid="x-item-title-label"], #x-item-title-label, h1.it-ttl, .x-item-title-label, h1.it-ttl',image:'#icImg, img[itemprop="image"], .img.img500, #mainImgHldr img',price:'.notranslate[itemprop="price"], #prcIsum, .u-flL.condText, .notranslate, .u-flL.condText .notranslate'},"ebay.ca":{name:'h1[data-testid="x-item-title-label"], #x-item-title-label, h1.it-ttl, .x-item-title-label, h1.it-ttl',image:'#icImg, img[itemprop="image"], .img.img500, #mainImgHldr img',price:'.notranslate[itemprop="price"], #prcIsum, .u-flL.condText, .notranslate, .u-flL.condText .notranslate'},"ebay.com.au":{name:'h1[data-testid="x-item-title-label"], #x-item-title-label, h1.it-ttl, .x-item-title-label, h1.it-ttl',image:'#icImg, img[itemprop="image"], .img.img500, #mainImgHldr img',price:'.notranslate[itemprop="price"], #prcIsum, .u-flL.condText, .notranslate, .u-flL.condText .notranslate'},"alibaba.com":{name:"",image:"",price:""},"jd.com":{name:"",image:"",price:""},"shopee.com":{name:"",image:"",price:""},"shopee.sg":{name:"",image:"",price:""},"shopee.co.id":{name:"",image:"",price:""},"shopee.com.my":{name:"",image:"",price:""},"shopee.ph":{name:"",image:"",price:""},"shopee.co.th":{name:"",image:"",price:""},"shopee.vn":{name:"",image:"",price:""},"walmart.com":{name:"#main-title",image:"img.db",price:"span"},"target.com":{name:"#pdp-product-title-id",price:"div.styles_priceFullLineHeight__BgU9C",image:"img"},"bestbuy.com":{name:"h1.h4",image:'img[fetchpriority="high"], img[loading="eager"][alt*="iPad"], img.flex.grow',price:"div.price-container, div.standard-layout__middle-block_price, span.font-sans"},"etsy.com":{name:"h1.wt-line-height-tight",price:".wt-text-title-larger.wt-mr-xs-1.wt-text-black .wt-screen-reader-only, .wt-screen-reader-only, div.n-listing-card__price",image:"img.wt-max-width-full"},"wayfair.com":{name:"",image:"",price:""},"chewy.com":{name:"",image:"",price:""},"newegg.com":{name:"",image:"",price:""},"temu.com":{name:"",image:"img._3eDhqCfZ",price:"div._1vkz0rqG"},"abercrombie.com":{name:"h1.product-title-component",price:"span.product-price-text, div.product-price-container",image:"img"},"pacsun.com":{name:"",image:"",price:""},"aeropostale.com":{name:"",image:"",price:""}};function t(e){try{return new URL(e).hostname.replace(/^www\./,"")}catch(e){return console.error("Error parsing URL:",e),""}}function r(){var e;const t=Array.from(document.querySelectorAll("h1"));if(0===t.length)return null;const r=t.filter((e=>e.innerText.trim().length>0)).map((e=>{const t=e.getBoundingClientRect();return{text:e.innerText.trim(),score:t.top+.5*e.innerText.length}}));return r.sort(((e,t)=>e.score-t.score)),(null===(e=r[0])||void 0===e?void 0:e.text)||null}function i(e){var t;const r=(null===(t=e.innerText)||void 0===t?void 0:t.trim())||"",i=r.match(/([$€£¥])\s?(\d+)/);if(i){const t=i[1],r=i[2],o=e.querySelectorAll('sup, [style*="vertical-align"], [style*="font-size"]');for(const e of o){var n;const i=((null===(n=e.textContent)||void 0===n?void 0:n.trim())||"").match(/^(\d{1,3})$/);if(i){const e=i[1].padStart(2,"0");return"".concat(t).concat(r,".").concat(e)}}if(e.parentElement){const i=Array.from(e.parentElement.children),n=i.indexOf(e);if(n>=0&&n<i.length-1){var c;const o=i[n+1],a=((null===(c=o.textContent)||void 0===c?void 0:c.trim())||"").match(/^(\d{1,3})$/),l=window.getComputedStyle(o),s=window.getComputedStyle(e),m="SUP"===o.tagName||"super"===l.verticalAlign||parseFloat(l.fontSize)<parseFloat(s.fontSize);if(a&&m){const e=a[1].padStart(2,"0");return"".concat(t).concat(r,".").concat(e)}}}return i[0]}const o=r.match(/([$€£¥]\s?\d+(?:[\.,]\d+)?)/);return o?o[1]:null}function n(){var e;const t=/([$€£¥]\s?\d+(?:[\.,]\d+)?)/,n=r();let c=null;if(n){const e=Array.from(document.querySelectorAll("h1"));c=e.find((e=>e.innerText.trim()===n))}const o=Array.from(document.querySelectorAll("body *")),a=["shipping","delivery","was","save","from","starting at","each","per","tax","fee","original","list","msrp"],l=o.filter((e=>{var r,n;if(null===e.offsetParent)return!1;const c=i(e),o=(null===(r=e.innerText)||void 0===r?void 0:r.trim())||"";if(!c&&!t.test(o))return!1;if(o.length>50)return!1;const l=o.toLowerCase();if(a.some((e=>l.includes(e))))return!1;const s=c||(null===(n=o.match(t))||void 0===n?void 0:n[1]);if(s){const e=parseFloat(s.replace(/[$€£¥\s,]/g,"").replace(",","."));if(e<.5)return!1;if(e>1e5)return!1}return!0})).map((e=>{const r=e.getBoundingClientRect();let n=i(e);if(!n){const r=e.innerText.match(t);if(!r)return null;n=r[1]}const o=parseFloat(n.replace(/[$€£¥\s,]/g,"").replace(",","."));let a=r.top;if(c){const e=c.getBoundingClientRect();Math.abs(r.top-e.bottom)<500&&(a-=200)}o>=5&&o<=5e3&&(a-=100);const l=window.getComputedStyle(e).fontSize;return parseFloat(l)>20&&(a-=50),o<5&&(a+=300),r.left>.7*window.innerWidth&&(a+=150),{price:n,score:a,priceValue:o}}));if(0===l.length)return null;const s=l.filter((e=>null!==e));return s.sort(((e,t)=>e.score-t.score)),(null===(e=s[0])||void 0===e?void 0:e.price)||null}function c(){var e;const t=Array.from(document.querySelectorAll("img"));if(0===t.length)return null;const r=t.filter((e=>{const t=e.getBoundingClientRect();if(t.width<100||t.height<100)return!1;if(null===e.offsetParent)return!1;const r=e.src||e.getAttribute("data-src")||e.getAttribute("data-lazy-src");if(!r||""===r.trim())return!1;const i=r.toLowerCase();return!(i.includes("logo")||i.includes("icon")||i.includes("avatar")||i.includes("spinner")||i.includes("placeholder"))})).map((e=>{const t=e.getBoundingClientRect();return{url:e.src||e.getAttribute("data-src")||e.getAttribute("data-lazy-src")||e.getAttribute("data-old-src"),score:t.width*t.height-10*t.top}}));return 0===r.length?null:(r.sort(((e,t)=>t.score-e.score)),(null===(e=r[0])||void 0===e?void 0:e.url)||null)}console.log("content script injected"),chrome.runtime.onMessage.addListener((function(a,l,s){return"extractProduct"===a.action&&((async()=>{try{const a=await async function(){const a=window.location.href,l=t(a);if(!function(t){if(e[t])return!0;const r=t.split(".");if(r.length>2){const t=r.slice(-2).join(".");if(e[t])return!0}return!1}(l)){const t=Object.keys(e),r=function(e){const t={};e.forEach((e=>{const r=e.split(".")[0];t[r]||(t[r]=[]),t[r].push(e)}));const r=[];return Object.keys(t).sort().forEach((e=>{const i=t[e];if(1===i.length)r.push("• ".concat(e.charAt(0).toUpperCase()+e.slice(1)," (").concat(i[0],")"));else{const t=i.find((e=>!e.includes(".co.")&&!e.includes(".com.")))||i[0],n=i.filter((e=>e!==t));n.length>0?r.push("• ".concat(e.charAt(0).toUpperCase()+e.slice(1)," (").concat(t).concat(n.length>2?", ".concat(n.length," more"):", "+n.join(", "),")")):r.push("• ".concat(e.charAt(0).toUpperCase()+e.slice(1)," (").concat(t,")"))}})),r.join("\n")}(t);throw{type:o.SITE_NOT_SUPPORTED,message:"Site not supported: ".concat(l),supportedSites:t,supportedSitesFormatted:r,domain:l}}const s=function(){let e=0;const t=[];document.querySelector('[itemtype*="Product"], [itemtype*="product"]')&&(e+=5,t.push("Schema.org Product markup found"));Array.from(document.querySelectorAll('script[type="application/ld+json"]')).some((e=>{try{const t=JSON.parse(e.textContent);return"Product"===t["@type"]||Array.isArray(t)&&t.some((e=>"Product"===e["@type"]))||t["@graph"]&&t["@graph"].some((e=>"Product"===e["@type"]))}catch(e){return!1}}))&&(e+=5,t.push("JSON-LD Product data found"));const r=["[data-product-id]","[data-product-name]","[data-product-price]","[data-product-sku]",'[itemprop="name"]','[itemprop="price"]','[itemprop="image"]'].filter((e=>document.querySelector(e)));r.length>0&&(e+=3,t.push("Product attributes found: ".concat(r.length)));const i=/([$€£¥])\s?(\d+(?:[\.,]\d+)?)/,n=Array.from(document.querySelectorAll("*")).filter((e=>{var t;const r=(null===(t=e.innerText)||void 0===t?void 0:t.trim())||"";return i.test(r)&&r.length<50&&null!==e.offsetParent}));n.length>0&&(e+=3,t.push("Price elements found: ".concat(n.length)));Array.from(document.querySelectorAll('button, a[role="button"], input[type="submit"]')).some((e=>{const t=(e.textContent||e.innerText||e.getAttribute("aria-label")||"").toLowerCase();return t.includes("add to cart")||t.includes("add to bag")||t.includes("buy now")||t.includes("purchase")}))&&(e+=4,t.push("Add to Cart / Buy button found"));const c=Array.from(document.querySelectorAll("img")).filter((e=>{if(null===e.offsetParent)return!1;const t=e.getBoundingClientRect();return t.width>=200&&t.height>=200&&e.src&&!e.src.includes("data:")&&!e.src.toLowerCase().includes("logo")&&!e.src.toLowerCase().includes("icon")}));c.length>0&&(e+=2,t.push("Product images found: ".concat(c.length)));Array.from(document.querySelectorAll("h1")).find((e=>{var t;const r=(null===(t=e.innerText)||void 0===t?void 0:t.trim())||"";return r.length>10&&r.length<200&&null!==e.offsetParent}))&&(e+=2,t.push("Product title (h1) found")),document.querySelectorAll('input[type="number"][name*="quantity" i], select[name*="quantity" i], [aria-label*="quantity" i]').length>0&&(e+=1,t.push("Quantity selector found")),['[itemprop="ratingValue"]','[itemprop="reviewRating"]',".rating",".reviews",'[aria-label*="star" i]','[aria-label*="rating" i]'].some((e=>document.querySelector(e)))&&(e+=1,t.push("Product reviews/ratings found")),['[name*="size" i]','[name*="color" i]','[name*="variant" i]',"[data-variant]",".product-variant",".size-selector",".color-selector"].some((e=>document.querySelector(e)))&&(e+=1,t.push("Product variants found"));const o=Math.min(e/20*100,100);return{isProductPage:e>=6,confidence:Math.round(o),score:e,maxScore:20,indicators:t}}();if(!s.isProductPage)throw{type:o.NOT_PRODUCT_PAGE,message:"This isn't a product page.",domain:l,confidence:s.confidence,indicators:s.indicators};const m=function(r){const i=t(r);if(e[i])return e[i];const n=i.split(".");if(n.length>2){const t=n.slice(-2).join(".");if(e[t])return e[t]}return null}(a);if(!m)throw new Error("Site not supported: ".concat(l));const p={name:null,image:null,price:null,site:l,url:a,timestamp:(new Date).toISOString()},u=l.includes("amazon."),d=l.includes("ebay."),g=l.includes("abercrombie.com");if(u){const e=!!document.querySelector(m.name||"#productTitle");let t=!1;if(m.price&&(t=m.price.split(",").map((e=>e.trim())).some((e=>document.querySelector(e)))),!e||!t)throw{type:o.NOT_PRODUCT_PAGE,message:"This isn't a product page.",domain:l,confidence:100,indicators:["Missing Amazon product title or price selectors on this page"]};if(m.name){const e=document.querySelector(m.name);e&&(p.name=e.textContent.trim())}if(m.price){const e=m.price.split(",").map((e=>e.trim())),t=/([$€£¥]\s?\d+(?:[\.,]\d+)?)/;for(const r of e){const e=document.querySelector(r);if(e){let r=i(e);if(!r&&(r=e.textContent||e.innerText,r&&""!==r.trim()||(r=e.getAttribute("aria-label")||e.title),r)){r=r.trim();const e=r.match(t);e?r=e[1]:(r=r.replace(/^\s*Price:\s*/i,""),r=r.replace(/\s*each\s*$/i,""))}if(r&&r.trim()){const t=e.closest(".a-price");if(t){const e=t.querySelector(".a-price-fraction");if(e){var f;const t=(null===(f=e.textContent)||void 0===f?void 0:f.trim())||"";t&&(r.endsWith(".")?r+=t:r.includes(".")||(r=r+"."+t))}}if(r&&r.trim()){p.price=r.trim();break}}}}}if(m.image){const e=m.image.split(",").map((e=>e.trim()));for(const t of e){const e=document.querySelector(t);if(e){let t=e.src||e.getAttribute("data-src")||e.getAttribute("data-lazy-src")||e.getAttribute("data-old-src");if(!t&&e.hasAttribute("data-a-dynamic-image"))try{const r=JSON.parse(e.getAttribute("data-a-dynamic-image")),i=Object.keys(r);i.length>0&&(t=i[0])}catch(e){console.warn("Failed to parse Amazon dynamic image data:",e)}if(t){p.image=t;break}}}}p.name||(p.name=r()),p.price||(p.price=n()),p.image||(p.image=c())}else if(d){if(m.name){const e=document.querySelector(m.name);e&&(p.name=e.textContent.trim())}if(m.price){const e=m.price.split(",").map((e=>e.trim())),t=/([$€£¥]\s?\d{1,3}(?:,\d{3})*(?:\.\d{1,2})?)/g,r=[];for(const n of e){const e=document.querySelectorAll(n);for(const c of e){const e=c.textContent||c.innerText||"";t.lastIndex=0;const o=e.match(t);let a=null,l=null;if(o&&o.length>=2){const e=o.map((e=>{const t=e.trim(),r=t.replace(/[$€£¥\s]/g,"").replace(/,/g,"");return{text:t,value:parseFloat(r)}}));e.sort(((e,t)=>t.value-e.value)),a=e[0].text,l=e[0].value}else if(o&&1===o.length){a=o[0].trim();const e=a.replace(/[$€£¥\s]/g,"").replace(/,/g,"");l=parseFloat(e)}else a=i(c),a&&(t.lastIndex=0,t.test(a)?l=parseFloat(a.replace(/[$€£¥\s,]/g,"").replace(",",".")):a=null);if(a&&null!==l){if(a.endsWith(".")){const e=c.parentElement;if(e){const r=e.textContent||e.innerText||"";t.lastIndex=0;const i=r.match(t);if(i&&i.length>0){const e=i.find((e=>e.startsWith(a)));e&&e.includes(".")&&(a=e,l=parseFloat(a.replace(/[$€£¥\s,]/g,"").replace(",",".")))}}}if(l>=.5&&l<=1e5){let e=0;(c.classList.contains("x-price-primary")||null!==c.closest(".x-price-primary")||"DIV"===c.tagName&&c.className.includes("x-price-primary")||"div.x-price-primary"===n||n.includes("x-price-primary")||c.classList.contains("x-bin-price__content")||null!==c.closest(".x-bin-price__content")||"DIV"===c.tagName&&c.className.includes("x-bin-price__content")||"div.x-bin-price__content"===n||n.includes("x-bin-price__content"))&&(c.classList.contains("x-price-primary")||null!==c.closest(".x-price-primary")||"div.x-price-primary"===n||n.includes("x-price-primary")?e+=2e5:e+=1e5),l>=50&&l<=1e3&&(e+=2e4),l<30&&(e-=5e4),e+=100*l,r.push({text:a.trim(),value:l,score:e,selector:n})}}}}if(r.length>0){r.sort(((e,t)=>t.score-e.score));const e=r[0];p.price=e.text}}if(m.image){const e=m.image.split(",").map((e=>e.trim()));for(const t of e){const e=document.querySelector(t);if(e){let t=e.src||e.getAttribute("data-src")||e.getAttribute("data-lazy-src")||e.getAttribute("data-old-src");if(t){p.image=t;break}}}}if(p.name||(p.name=r()),!p.price){if(m.price){const e=m.price.split(",").map((e=>e.trim())),t=/([$€£¥]\s?\d+\.\d{1,2}|[$€£¥]\s?\d+)/g,r=[];for(const i of e){const e=document.querySelectorAll(i);for(const i of e){const e=i.textContent||i.innerText||"";if(!e||e.trim().length<3)continue;t.lastIndex=0;const n=e.match(t);n&&n.length>0&&n.forEach((e=>{const t=e.trim(),i=parseFloat(t.replace(/[$€£¥\s,]/g,"").replace(",","."));if(i>=.5&&i<=1e5){let e=0;/\.\d{1,2}$/.test(t)&&(e+=1e3),i>=5&&i<=1e3&&(e+=500),e+=10*t.length,r.push({text:t,value:i,score:e})}}))}}r.length>0&&(r.sort(((e,t)=>t.score-e.score)),p.price=r[0].text)}p.price||(p.price=n())}p.image||(p.image=c())}else if(g){const e=!!m.name&&!!document.querySelector(m.name),t=!!m.price&&!!document.querySelector(m.price);if(!e||!t)throw{type:o.NOT_PRODUCT_PAGE,message:"This isn't a product page.",domain:l,confidence:100,indicators:["Abercrombie: missing product title or price selectors"]};if(m.name){const e=document.querySelector("h1.product-title-component.product-title-main-header");if(e)p.name=e.textContent.trim();else{const e=document.querySelector(m.name);e&&(p.name=e.textContent.trim())}}if(m.price){let e=null,t=!1;const r=/([$€£¥]\s?\d+(?:[\.,]\d+)?)/g,n=document.querySelector("span.product-price-text");if(n){const i=n.textContent||n.innerText||"";r.lastIndex=0;const c=i.match(r);if(c&&c[0]){e=c[0].trim();const i=n.closest("div.product-price-container")||document.querySelector("div.product-price-container");if(i){const e=i.textContent||i.innerText||"";r.lastIndex=0;const n=e.match(r);n&&n.length>=2&&(t=!0)}}}if(!e){const n=document.querySelector(m.price);if(n){const c=n.querySelector('[data-variant="discount"]');if(c){t=!0;let n=i(c);if(!n){const e=c.textContent||c.innerText||"";r.lastIndex=0;const t=e.match(r);t&&(n=t[0])}n&&r.test(n)&&(e=n.trim())}if(!e){const i=n.querySelector("span.product-price-text");if(i){const c=i.textContent||i.innerText||"";r.lastIndex=0;const o=c.match(r);if(o){e=o[0].trim();const i=n.querySelector(".product-price-text-wrapper");if(i){const e=i.textContent||i.innerText||"";r.lastIndex=0;const n=e.match(r);n&&n.length>=2&&(t=!0)}}}}if(!e){const i=n.querySelector(".product-price-text-wrapper");if(i){const n=i.textContent||i.innerText||"";r.lastIndex=0;const c=n.match(r);if(c&&c.length>=2){const r=c.map((e=>{const t=parseFloat(e.replace(/[$€£¥\s,]/g,"").replace(",","."));return{text:e.trim(),value:t}}));r.sort(((e,t)=>e.value-t.value)),r.length>=2&&r[0].value<r[1].value?(t=!0,e=r[0].text):e=r[0].text}else c&&1===c.length&&(e=c[0].trim())}}if(!e){const t=n.querySelector('[data-variant="original"]');if(t){let n=i(t);if(!n){const e=t.textContent||t.innerText||"";r.lastIndex=0;const i=e.match(r);i&&(n=i[0])}n&&r.test(n)&&(e=n.trim())}}if(!e){const c=n.querySelector('.product-price-text-wrapper[data-variant="discount"]');if(c){t=!0;let n=i(c);if(!n){const e=c.textContent||c.innerText||"";r.lastIndex=0;const t=e.match(r);t&&(n=t[0])}n&&r.test(n)&&(e=n.trim())}}e||(e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data-variant",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"discount",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"original";const c=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:document).querySelector(e);if(!c)return null;const o=/([$€£¥]\s?\d+(?:[\.,]\d+)?)/,a=c.querySelector("[".concat(t,'="').concat(r,'"]'));if(a){let e=i(a);if(!e){const t=(a.textContent||a.innerText||"").match(o);t&&(e=t[1])}if(e&&o.test(e))return e.trim()}const l=c.querySelector("[".concat(t,'="').concat(n,'"]'));if(l){let e=i(l);if(!e){const t=(l.textContent||l.innerText||"").match(o);t&&(e=t[1])}if(e&&o.test(e))return e.trim()}let s=i(c);if(!s){const e=(c.textContent||c.innerText||"").match(o);e&&(s=e[1])}return s&&o.test(s)?s.trim():null}(m.price,"data-variant","discount","original"),e&&n.querySelector('[data-variant="discount"]')&&(t=!0))}}if(e&&t){const t=document.querySelector("div.product-price-container");if(t){const i=t.textContent||t.innerText||"";r.lastIndex=0;const n=i.match(r);if(n&&n.length>=2){const t=n.map((e=>{const t=parseFloat(e.replace(/[$€£¥\s,]/g,"").replace(",","."));return{text:e.trim(),value:t}}));t.sort(((e,t)=>e.value-t.value));const r=parseFloat(e.replace(/[$€£¥\s,]/g,"").replace(",","."));t[0].value<r&&(e=t[0].text)}}}if(e){const r=parseFloat(e.replace(/[$€£¥\s,]/g,"").replace(",","."));r>=.5&&r<=1e5&&(p.price=e,t&&(p.isDiscounted=!0))}if(!p.price){const e=m.price.split(",").map((e=>e.trim())),t=/([$€£¥]\s?\d+(?:[\.,]\d+)?)/;for(const r of e){const e=document.querySelector(r);if(e){let r=i(e);if(!r&&(r=e.textContent||e.innerText,r)){r=r.trim();const e=r.match(t);e&&(r=e[1])}if(r&&t.test(r)){const e=parseFloat(r.replace(/[$€£¥\s,]/g,"").replace(",","."));if(e>=.5&&e<=1e5){p.price=r.trim();break}}}}}}if(m.image){const e=Array.from(document.querySelectorAll("img")).filter((e=>{const t=e.getBoundingClientRect();return!(!(e.src||e.getAttribute("data-src")||e.getAttribute("data-lazy-src"))||null===e.offsetParent)&&t.width>=200&&t.height>=200}));if(e.sort(((e,t)=>{const r=e.getBoundingClientRect(),i=t.getBoundingClientRect();return i.width*i.height-r.width*r.height})),e.length>0){const t=e[0];p.image=t.src||t.getAttribute("data-src")||t.getAttribute("data-lazy-src")}}p.name||(p.name=r()),p.price||(p.price=n()),p.image||(p.image=c())}else{if(m.name){const e=document.querySelector(m.name);e&&(p.name=e.textContent.trim())}if(m.price){const e=m.price.split(",").map((e=>e.trim())),t=/([$€£¥]\s?\d+\.\d{1,2}|[$€£¥]\s?\d+)/g,r=[];for(const i of e){const e=document.querySelectorAll(i);for(const i of e){const e=i.textContent||i.innerText||"";if(!e||e.trim().length<3)continue;t.lastIndex=0;const n=e.match(t);n&&n.length>0&&n.forEach((e=>{const t=e.trim(),i=parseFloat(t.replace(/[$€£¥\s,]/g,"").replace(",","."));if(i>=.5&&i<=1e5){let e=0;/\.\d{1,2}$/.test(t)&&(e+=1e4),i>=5&&i<=1e3&&(e+=5e3),e+=100*t.length,r.push({text:t,value:i,score:e})}}))}}r.length>0&&(r.sort(((e,t)=>t.score-e.score)),p.price=r[0].text)}if(m.image){const e=m.image.split(",").map((e=>e.trim()));for(const t of e){const e=document.querySelector(t);if(e){let t=e.src||e.getAttribute("data-src")||e.getAttribute("data-lazy-src")||e.getAttribute("data-old-src");if(t){p.image=t;break}}}}p.name||(p.name=r()),p.price||(p.price=n()),p.image||(p.image=c())}if(!p.name&&!p.image&&!p.price)throw new Error("Could not find product information on this page. Make sure you are on a product page.");return p}();s({success:!0,data:a})}catch(e){e.type?s({success:!1,error:e.message,errorType:e.type,errorData:e}):s({success:!1,error:e.message||"Failed to extract product information",errorType:"UNKNOWN_ERROR"})}})(),!0)}));const o={NOT_PRODUCT_PAGE:"NOT_PRODUCT_PAGE",SITE_NOT_SUPPORTED:"SITE_NOT_SUPPORTED"}})();